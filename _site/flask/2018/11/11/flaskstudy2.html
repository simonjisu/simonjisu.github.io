<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>[비전공자의 Flask-2] 본격 앱 만들기 1</title>
  <meta name="description" content="[비전공자의 Flask-2] 본격 앱 만들기 1">
  
  <meta name="author" content="Soo">
  <meta name="copyright" content="&copy; Soo 2018">
  

  <!-- External libraries -->
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/css/lightbox.css">

  <!-- Favicon and other icons (made with http://www.favicon-generator.org/) -->
  <link rel="shortcut icon" href="/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" sizes="57x57" href="/assets/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/assets/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png">
  <link rel="manifest" href="/assets/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  
  <!-- Facebook OGP cards -->
  <meta property="og:description" content="[비전공자의 Flask-2] 본격 앱 만들기 1" />
  <meta property="og:url" content="http://simonjisu.github.io" />
  <meta property="og:site_name" content="Soo" />
  <meta property="og:title" content="[비전공자의 Flask-2] 본격 앱 만들기 1" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="http://simonjisu.github.io/assets/logo.png" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:width" content="612" />
  <meta property="og:image:height" content="605" />
  

  
  <!-- Twitter: card tags -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="[비전공자의 Flask-2] 본격 앱 만들기 1">
  <meta name="twitter:description" content="[비전공자의 Flask-2] 본격 앱 만들기 1">
  <meta name="twitter:image" content="http://simonjisu.github.io/assets/logo.png">
  <meta name="twitter:url" content="http://simonjisu.github.io">
  

  

  <!-- Site styles -->
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://simonjisu.github.io/flask/2018/11/11/flaskstudy2.html">
  <link rel="alternate" type="application/rss+xml" title="Soo" href="http://simonjisu.github.io/feed.xml" />


  <!-- <script type="text/javascript"
          src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" ></script> -->

  <!-- Latex -->
  <script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Register.StartupHook("TeX Jax Ready",function () {
      MathJax.Hub.Insert(MathJax.InputJax.TeX.Definitions.macros,{
        cancel: ["Extension","cancel"],
        bcancel: ["Extension","cancel"],
        xcancel: ["Extension","cancel"],
        cancelto: ["Extension","cancel"]
      });
    });
    MathJax.Hub.Config({
        TeX: {
            extensions: ["mhchem.js", "cancel.js"]
        },
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            processEscapes: true,
            processEnvironments: true,
            ignoreClass: "no-mathjax",
        },
        displayAlign: 'center',
        "HTML-CSS": {
            styles: {'.MathJax_Display': {"margin": 0}},
            // linebreaks: { automatic: true }
        },
        menuSettings: {
            zoom: "Click",
            zscale: "200%"
        }
    });
  </script>

  <!--lightSlider-->
  <link rel="stylesheet" href="/css/lightslider.css" />

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5GSH93K');</script>
  <!-- End Google Tag Manager -->

  <!-- Google Ad -->
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-5855917513482122",
      enable_page_level_ads: true
    });
  </script>
  <!-- End Google Ad -->

</head>


  <body>

    <header class="navigation" role="banner">
  <div class="navigation-wrapper">
    <a href="/" class="logo">
      
      <img src="/assets/logo.png" alt="Soo">
      
    </a>
    <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu">
      <i class="fa fa-bars"></i>
    </a>
    <nav role="navigation">
      <ul id="js-navigation-menu" class="navigation-menu show">
        
          
        
          
        
          
        
          
          <li class="nav-link"><a href="/posts/">Posts</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          <li class="nav-link"><a href="https://simonjisu.gitbook.io/resume/"> ME </a>
          <li class="nav-link"><a href="https://github.com/simonjisu"> GitHub </a>
      </ul>
    </nav>
  </div>
</header>


    <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5GSH93K"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->


    <div class="page-content">
        <div class="post">
<div class="post-header-container " >
  <div class="scrim ">
    <header class="post-header">
      <h1 class="title">[비전공자의 Flask-2] 본격 앱 만들기 1</h1>
      <p class="info">by <strong>Soo</strong></p>
    </header>
  </div>
</div>

<div class="wrapper">

 <span class="page-divider">
  <span class="one"></span>
  <span class="two"></span>
</span>
 

<section class="post-meta">
  <div class="post-date">November 11, 2018</div>
  <div class="post-categories">
   in 
    
    <a href="/posts/#Flask">Flask</a>
    
  
  </div>
</section>

<article class="post-content">
  <h1 id="flask-2----1">[비전공자의 Flask-2] 본격 앱 만들기 1</h1>

<h2 id="section">폴더 생성부터 데이터베이스 만들기</h2>

<p>내가 만드려고 하는 앱은 사용자가 어떤 query 를 날리면 이를 모델을 거쳐서 결과를 웹에서 보여주는 간단한 앱이다. 예를 들어, 번역기 같은 앱의 경우를 생각해보자.</p>

<ol>
  <li>사용자 (웹페이지 방문자)는 번역하고자 하는 글을 쓴고 “번역” 버튼을 클릭한다.</li>
  <li>번역 클릭 후, 해당 string이 flask를 통해 전송 받으면 이를 모델에 넣어서 결과를 뱉는다.</li>
  <li>결과를 다시 flask 앱을 통해 사용자에게 보여준다.</li>
</ol>

<p>구체적으로 <a href="https://simonjisu.github.io/datascience/2017/08/04/E2EMN.html">End to End Memory Network</a> 모델을 활용해서 스토리 내용을 사용자가 선택해서 질문을 던지면 그에 대한 결과를 받는 앱을 만들 것이다.</p>

<h2 id="step-0--">Step 0: 폴더 생성하기</h2>

<p>어플리케이션 개발을 시작하기전에, 어플리케이션에서 사용할 폴더를 만들자.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>/e2eapp
    /static
    /templates
</code></pre>
</div>

<p>앞으로 이 <strong>“nmtapp”</strong> 폴더 안에 우리가 사용할 것들을 넣는다. <strong>“static”</strong> 은 사용자들을 위한 폴더, 이 폴더는 css와 javascript 파일들이 저장되는 곳이다. Flasks는 templates 폴더에서 <a href="http://jinja.pocoo.org/">Jinja2</a> 템플릿을 찾을 것이다.</p>

<h2 id="step-1--">Step 1: 데이터베이스 스키마</h2>

<p>데이터베이스 스키마를 생성해야 한다. 우리의 어플리케이션은 단지 하나의 테이블만 필요하며 사용이 매우 쉬운 SQLite를 쓸것이다. 다음의 내용을 schema.sql 이라는 이름의 파일로 방금 생성한 nmtapp 폴더에 저장한다.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>drop table if exists nmtmain;
create table nmtmain (
  id integer primary key autoincrement,
   question string not null
);
</code></pre>
</div>

<p>해당 테이블의 이름은 “nmtmain” 이며, 간략하게 칼럼을 소개하자면, 아래와같다.</p>

<ul>
  <li>id: 자동으로 증가되는 정수이며 프라이머리 키(primary key) 이다.</li>
  <li>query: 사용자들이 입력한 질문.</li>
</ul>

<blockquote>
  <p>데이터베이스 스키마(database schema)란 데이터베이스에서 자료의 구조, 자료의 표현 방법, 자료 간의 관계를 형식 언어로 정의한 구조이다.</p>
</blockquote>

<h2 id="step-2---">Step 2: 어플리케이션 셋업 코드</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>/e2eapp
    /static
    /templates
    /schema.sql
    /nmtstart.py
    /settings.py
</code></pre>
</div>

<h3 id="settingspy">settings.py</h3>

<p>추가로 앱을 실행하기 위한 파일들을 만든다. 중요한 정보 혹은 환경변수가 있는 파일은 <strong>“settings.py”</strong> 에 넣기로 한다.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>## settings.py
# configuration
DATABASE = '../data/nmtmain.db'
DEBUG = True
SECRET_KEY = 'development key'
USERNAME = 'admin'
PASSWORD = 'password'
</code></pre>
</div>

<p>클라이언트에서의 세션을 안전하게 보장하기 위해서는 secret_key 가 필요하다. secret_key는 추측이 어렵도록 가능한 복잡하게 선택하여야 한다. 디버그(DEBUG) 플래그는 인터랙티브 디버거를 활성화 시키거나 비활성화 시키는 일을 한다. 운영시스템에서는 디버그 모드를 절대로 활성화 시키지 말아야 한다. 왜냐하면 디버그 모드에서는 사용자가 서버의 코드를 실행할수가 있기 때문이다.</p>

<h3 id="nmtstartpy">nmtstart.py</h3>

<p>앱을 실행하는 <strong>“nmtstart.py”</strong> 파일을 만든다.</p>

<div class="highlighter-rouge"><pre class="highlight"><code># all the imports
import sqlite3
from flask import Flask, request, session, g, redirect, url_for, abort, render_template, flash

# create application
app = Flask(__name__)
app.config.from_pyfile("./settings.py", silent=True)

def connect_db():
    return sqlite3.connect(app.config['DATABASE'])

if __name__ == '__main__':
    app.run(host='0.0.0.0')
</code></pre>
</div>

<p>아직 모르는 import 가 많지만, 차차 배울테니 우선 앱을 만들고 실행하는 부분을 알아보자.</p>

<p><strong>환경설정 불러오기:</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>config.from_pyfile("./settings.py", silent=True)
</code></pre>
</div>
<p>만약에 현재 파일 위치에 환경변수 객체(settings.py 의 내용)를 작성하였으면 <code class="highlighter-rouge">from_object(__name__)</code> 라는 명령어를 쓰면 된다.</p>

<p><strong>실행</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>(venv) /e2eapp $ python3 nmtstart.py  
...
192.168.6.34 - - [11/Nov/2018 19:08:40] "GET / HTTP/1.1" 404 -
192.168.6.34 - - [11/Nov/2018 19:08:40] "GET /favicon.ico HTTP/1.1" 404 -
</code></pre>
</div>

<p>지금은 어떤 뷰(view)를 만들지 않았기 때문에, 브라우저에서 페이지를 찾을 수 없다는 404에러를 볼 수 있을 것이다. 이건 나중에 살펴보고, 우선 데이터베이스를 만들고 진행하도록 하자.</p>

<h2 id="step-3--">Step 3: 데이터베이스 생성하기</h2>

<p>현재 만들고자 하는 앱은 관계형 데이터베이스 시스템에 의해 구동되는 어플리케이션이다. 이러한 시스템은 어떻게 데이터를 저장할지에 대한 정보를 가지고 있는 스키마가 필요하다. 그래서 처음으로 서버를 실행하기 전에 스키마를 생성하는 것이 중요하다.</p>

<p>우선 데이터를 어디다 저장할지 정해보자. 데이터는 앱 밖에 있는 <strong>data</strong> 폴더를 생성해서 저장하기로 한다.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>/demo
	/venv
	/e2eapp
	/data
</code></pre>
</div>

<p>아까 만들어둔 <strong>“schema.sql”</strong> 파일을 이용하여 sqlite3 명령어를 사용하여 다음과 같이 만들 수 있다.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(venv) /e2eapp $ sqlite3 ../data/nmtmain.db &lt; schema.sql
</code></pre>
</div>

<p>Sqlite3 가 설치 안됐을 수도 있다. 아래 명령어를 쳐서 (가상환경 빠져나와서) sqlite3 를 설치하자.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo apt-get install sqlite3
</code></pre>
</div>

<p>데이터베이스를 초기화하는 함수를 만들고 싶다면 contextlib 의 closing 함수를 import 한다.</p>

<div class="highlighter-rouge"><pre class="highlight"><code># import 에 추가
from contextlib import closing

def init_db():
    with closing(connect_db()) as db:
        with app.open_resource('schema.sql') as f:
            db.cursor().executescript(f.read())
        db.commit()
</code></pre>
</div>

<p><strong>함수설명</strong></p>

<ul>
  <li><strong>closing:</strong> with 블럭안에서 연결한 커넥션을 유지하도록 도와준다.</li>
  <li><strong>app객체의 open_resource:</strong> 리소스 경로(nmtapp 의 폴더)의 파일을 열고 그 값을 읽을 수 있다. 우리는 이것을 이용하여 데이터베이스에 연결하는 스크립트를 실행시킬 것이다.</li>
</ul>

<p>다음 시간에는 데이터베이스와 연결하고, 뷰함수 및 템플릿을 만들어보자.</p>

<h2 id="reference">Reference</h2>

<ul>
  <li><a href="https://flask-docs-kr.readthedocs.io/ko/latest/installation.html">flask 한글 튜토리얼</a></li>
  <li><a href="https://wikidocs.net/book/1530">SQLite로 가볍게 배우는 데이터베이스</a></li>
</ul>

  <!-- <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> -->
<br>
<br>
<!-- google_ad -->
<ins class="adsbygoogle"
     style="display: block; text-align: center; width: 100%; height: auto;"
     data-ad-client="ca-pub-5855917513482122"
     data-ad-slot="9197714545"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

</article>



<section class="rss">
  <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p>
</section>

<section class="share">
  <span>Share: </span>
  
    
    
      <a href="//www.facebook.com/sharer.php?t=%5B%EB%B9%84%EC%A0%84%EA%B3%B5%EC%9E%90%EC%9D%98+Flask-2%5D+%EB%B3%B8%EA%B2%A9+%EC%95%B1+%EB%A7%8C%EB%93%A4%EA%B8%B0+1&u=http%3A%2F%2Fsimonjisu.github.io%2Fflask%2F2018%2F11%2F11%2Fflaskstudy2.html"
        onclick="window.open(this.href, 'facebook-share', 'width=550,height=255');return false;">
        <i class="fa fa-facebook-square fa-lg"></i>
      </a>
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
</section>



  
    
    <!-- <h2 id="Flask">-1</h2> -->
    <!-- <h2 id="Flask">/flask/2018/10/28/flaskstudy0.html</h2> -->
    
    <!-- <h2 id="Flask">1</h2> -->
    <!-- <h2 id="Flask">/flask/2018/10/30/flaskstudy1.html</h2> -->
    



  
	<section class="post-navigation">
		<span class="prev-post">
			
				<a href="/flask/2018/10/30/flaskstudy1.html">
					<span class="fa-stack fa-lg">
						<i class="fa fa-square fa-stack-2x"></i>
						<i class="fa fa-angle-double-left fa-stack-1x fa-inverse"></i>
					</span>
					<span class="page-number">[비전공자의 Flask-1] 첫 앱 만들어보기</span>
				</a>
			
		</span>
		<span class="next-post">
			
		</span>
	</section>




  
  <section class="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname = 'soopace';

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </section>
  


</div>
</div>

    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h3 class="footer-heading">Soo</h3>

    <div class="site-navigation">

      <p><strong>Site Map</strong></p>
      <ul class="pages">
        
        
        
        
        
        
        
        
          <li class="nav-link"><a href="/posts/">Posts</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </ul>
    </div>

    <div class="site-contact">

      <p><strong>Contact</strong></p>
      <ul class="social-media-list">
        <li>
          <a href="mailto:simonjisu@gmail.com">
            <i class="fa fa-envelope-o"></i>
            <span class="username">simonjisu@gmail.com</span>
          </a>
        </li>

        
          
          <li>
            <a href="https://www.facebook.com/simonjisu" title="Friend me on Facebook">
              <i class="fa fa-facebook"></i>
              <span class="username">simonjisu</span>
            </a>
          </li>
          
        
          
          <li>
            <a href="https://github.com/simonjisu" title="Fork me on GitHub">
              <i class="fa fa-github"></i>
              <span class="username">simonjisu</span>
            </a>
          </li>
          
        
          
        
          
        

      </ul>
    </div>

    <div class="site-signature">
      <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p>
      <p class="text">My Blog
</p>
    </div>

  </div>
</footer>

<!-- Scripts -->
<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>

<!-- Mathjax -->
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/js/lightbox.min.js"></script>
<script type="text/javascript">
$(document).ready(function() {
  // Default syntax highlighting
  hljs.initHighlightingOnLoad();
  $("code").addClass("python")
  // Header
  var menuToggle = $('#js-mobile-menu').unbind();
  $('#js-navigation-menu').removeClass("show");
  menuToggle.on('click', function(e) {
    e.preventDefault();
    $('#js-navigation-menu').slideToggle(function(){
      if($('#js-navigation-menu').is(':hidden')) {
        $('#js-navigation-menu').removeAttr('style');
      }
    });
  });
});
$("code").addClass("python")
</script>

<!--lightSlider-->
<script src="/js/lightslider.js"></script>
<script src='/js/multi_slider.js' type="text/javascript"></script>





    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-102691608-1', 'auto');
  ga('send', 'pageview');
</script>


  </body>

</html>
