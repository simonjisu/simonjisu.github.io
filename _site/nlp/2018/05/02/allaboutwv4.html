<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>All about Word Vectors: GloVe</title>
  <meta name="description" content="본 포스팅은 CS224n Lecture 3 강의내용을 기반으로 강의 내용 이해를 돕고자 작성 됐습니다.Co-occurrence공기(Co-occurrence) 란 무엇인가? 두 개 이상의 어휘가 일정한 범위(range) 혹은 거리(distance) 내에서 함께 출현하는 현상을 말한다...">

  <!-- evil icon -->
  <link rel="stylesheet" href="/assets/evil-icons.min.css">
  <script src="/assets/evil-icons.min.js"></script>

  <!-- todo: include this into main.css -->
  <link href='https://fonts.googleapis.com/css?family=' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://simonjisu.github.io/nlp/2018/05/02/allaboutwv4.html">
  <link rel="alternate" type="application/rss+xml" title="Soopace" href="https://simonjisu.github.io/feed.xml">
  
  <!-- Favicon and other icons (made with http://www.favicon-generator.org/) -->
  <link rel="shortcut icon" href="/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" sizes="57x57" href="/assets/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/assets/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png">
  <link rel="manifest" href="/assets/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5GSH93K');
  </script>
  <!-- End Google Tag Manager -->

  <script type="text/javascript" async
src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Register.StartupHook("TeX Jax Ready",function () {
    MathJax.Hub.Insert(MathJax.InputJax.TeX.Definitions.macros,{
    cancel: ["Extension","cancel"],
    bcancel: ["Extension","cancel"],
    xcancel: ["Extension","cancel"],
    cancelto: ["Extension","cancel"]
    });
});
MathJax.Hub.Config({
    TeX: {
        extensions: ["mhchem.js", "cancel.js"]
    },
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true,
        processEnvironments: true,
        ignoreClass: "no-mathjax",
    },
    displayAlign: 'center',
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}},
        // linebreaks: { automatic: true }
    },
    menuSettings: {
        zoom: "Click",
        zscale: "200%"
    }
});
</script>
  <!-- Latex -->
  
</head>

  <body>
    <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5GSH93K"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

    <div class="page-content">
      <div class="container">
        <div class="three columns">
          <header class="site-header">
  <h2 class="logo">
    <a href="/">Soopace</a>
    <div class="logoimage box" style="background: url(/assets/img/logo.png)"></div>
  </h2>

  <div class="nav">
    <label for="menu-toggle" class="menu-icon">
        <!--div data-icon="ei-navicon"></div-->
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
    </label>
    <input type="checkbox" id="menu-toggle">
    <div class="site-nav">
      <nav class="page-link">
      
      
        
          <ul class="">
            <li><a href="https://simonjisu.github.io/">Home</a></li>
          </ul>
        
      
        
          <ul class="dropdown">
            <li>
              <a href="https://simonjisu.github.io/archive" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Posts</a>
              <ul class="dropdown-menu">
              
              
                
                  <li role="separator" class="divider"></li>
                
              
              
                
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                      <li>
                        <a href="https://simonjisu.github.io/archive#nlp" target="_self">Nlp</a>
                      </li>
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                
              
              
                
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                      <li>
                        <a href="https://simonjisu.github.io/archive#math" target="_self">Math</a>
                      </li>
                    
                  
                
              
              
                
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                      <li>
                        <a href="https://simonjisu.github.io/archive#paper" target="_self">Paper</a>
                      </li>
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                
              
              
                
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                      <li>
                        <a href="https://simonjisu.github.io/archive#others" target="_self">Others</a>
                      </li>
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                
              
              
                
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                      <li>
                        <a href="https://simonjisu.github.io/archive#programming" target="_self">Programming</a>
                      </li>
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                
              
              
                
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                      <li>
                        <a href="https://simonjisu.github.io/archive#datascience" target="_self">Datascience</a>
                      </li>
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                
              
              
                
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                      <li>
                        <a href="https://simonjisu.github.io/archive#numpyseries" target="_self">Numpyseries</a>
                      </li>
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                    <!-- Site Navigation to "archive#subcat" -->
                    
                    
                  
                
              
              
                
                  <li role="lightseparator" class="lightdivider"></li>
                
              
              
                
                  <li>
                    <a href="https://soo.gitbook.io/prml/" target="_blank"> PRML </a>
                  </li>
                
              
              
                
                  <li role="separator" class="divider"></li>
                
              
              </ul>
            </li> 
          </ul>
        
      
        
          <ul class="">
            <li><a href="https://simonjisu.github.io/about">Abouts</a></li>
          </ul>
        
      
        
          <ul class="">
            <li><a href="https://simonjisu.github.io/feed.xml">RSS</a></li>
          </ul>
        
      
      </nav>
    </div>
  </div>
  <div class="adblock">
    <!-- Google Ad -->
    
      <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-5855917513482122"
     data-ad-slot="9197714545"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>  
    
    </div>
</header>

        </div>

        <div class="nine columns" style="z-index:100;">
          <div class="wrapper">
            <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="article_header">
    <h1 id="article_top" itemprop="name headline">All about Word Vectors: GloVe</h1>
    <p class="article_meta"><time datetime="2018-05-02T23:22:05+09:00" itemprop="datePublished">May 2, 2018</time> • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Soo</span></span></p>
    <hr>
  </header>
  <div>
    
    <div id="table-of-contents">
      <h2> Contents </h2>
      <ul class="toc-nav">
  <li><a href="#co-occurrence">Co-occurrence</a></li>
  <li><a href="#example-window-based-co-occurrence-matrix">Example: Window based co-occurrence matrix</a></li>
  <li><a href="#glove">GloVe</a>
    <ul>
      <li><a href="#논문-해설">논문 해설</a></li>
      <li><a href="#참고-1-homomorphism">참고 1: Homomorphism</a></li>
    </ul>
  </li>
</ul>
    </div>
    
    <div class="article-content" itemprop="articleBody">
      <p>본 포스팅은 <a href="http://web.stanford.edu/class/cs224n/">CS224n</a> Lecture 3 강의내용을 기반으로 강의 내용 이해를 돕고자 작성 됐습니다.</p>

<h1 id="co-occurrence">Co-occurrence</h1>

<p>공기(Co-occurrence) 란 무엇인가? 두 개 이상의 어휘가 일정한 범위(range) 혹은 거리(distance) 내에서 함께 출현하는 현상을 말한다. 여기서 어휘는 단어 뿐만 아니라 형태소, 합성어 등의 단위로 의미를 부여할 수 있는 언어 단위다. 그렇다면 왜 <strong>공기 관계</strong> 를 살피는 것일까?</p>

<p>공기 관계를 통해 문서나 문장으로 부터 <strong>추상화된 정보</strong> 를 얻기 위해서다. 이는 자연어처리의 가정을 생각해보면 이해할 수 있을 것이다.</p>

<blockquote>
  <p>비슷한 맥락에 등장하는 단어들은 유사한 의미를 지니는 경향이 있다.</p>
</blockquote>

<p>때문에, 두 단어가 같이 등장한 횟수가 많아지면 <strong>유사한 의미</strong> 를 가졌다고 볼 수도 있다는 것이다. 이런 유사한 의미를 추상화된 정보로 볼 수 있다.</p>

<p>공기(Co-occurrence) 정보를 수집하는 방법은 두 가지다.</p>

<ol>
  <li>window 기반: 품사와 의미(semantic) 정보를 캡쳐할 수 있다.</li>
  <li>word-document co-occurrence matrix 기반: 조금 더 일반적인 토픽을 추출 할 수 있고, 이는 Latent Semantic Analysis 와 연결 된다.</li>
</ol>

<h1 id="example-window-based-co-occurrence-matrix">Example: Window based co-occurrence matrix</h1>

<blockquote>
  <p>I like deep learning.</p>

  <p>I like NLP.</p>

  <p>I enjoy flying.</p>
</blockquote>

<p>위 3 문장을 사용해서, window size = 1 로 지정하는 co-occurrence matrix 를 만들어보자. 무슨 뜻인지는 아래 코드를 실행한 표를 살펴보자.</p>

<p>단, 한 단어에 대해서 좌측에서 등장했는지 우측에서 등장했는 지는 상관없다(이는 co-occurrence matrix 가 대각을 기준으로 대칭하는 결과를 불러옴)</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import pandas as pd
import numpy as np
from collections import deque, Counter
from itertools import islice
from scipy.sparse import coo_matrix

flatten = lambda t: [tuple(j) for i in t for j in i]
window = 1

def get_cooccur_list(sentence, window):
    s_len = len(sentence)
    ngram_list = [deque(islice(sentence, i), window+1) for i in range(s_len+1)][2:]
    return ngram_list

sentences = ['I like deep learning .', 'I like NLP .', 'I enjoy flying .']
tokens = [s.split() for s in sentences]
vocab = list(set([w for s in tokens for w in s]))
# print(vocab)
vocab = ['I', 'like', 'enjoy', 'deep', 'learning', 'NLP', 'flying', '.'] # 표와 같은 모양을 만들어주기 위해 다시 지정
vocab2idx = {w: i for i, w in enumerate(vocab)}
tokens_idx = [[vocab2idx.get(w) for w in s] for s in tokens]
co_occurs = [get_cooccur_list(s, window) for s in tokens_idx]

d = Counter()
d.update(flatten(co_occurs))
row, col, data = list(zip(*[[r, c, v] for (r, c), v in d.items()]))
temp = coo_matrix((data, (row, col)), shape=(len(vocab), len(vocab))).toarray()
co_mat = temp.T + temp

pd.DataFrame(co_mat, index=vocab, columns=vocab)
</code></pre></div></div>

<p>코드를 실행하면 아래와 같은 표가 나온다. window size 가 1이니까 “I” 주변 한칸에 동시 등장 단어는 “like” 가 2번 “enjoy” 가 1번이다.</p>

<table>
  <thead>
    <tr>
      <th>counts</th>
      <th>I</th>
      <th>like</th>
      <th>enjoy</th>
      <th>deep</th>
      <th>learning</th>
      <th>NLP</th>
      <th>flying</th>
      <th>.</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>I</td>
      <td>0</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>like</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>enjoy</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <td>deep</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>learning</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <td>NLP</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <td>flying</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <td>.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>

<p>co-occurrence matrix와 같은 단어 벡터는 어떤 문제점이 있을까?</p>

<p>첫째로, 단어가 많아지면 벡터가 엄청 길어진다(데이터 차원이 커진)는 것이다. 이에 따른 많은 저장 비용이 들어갈 것이다. 둘째로, sparsity issues가 있을 수 있다(models are less robust).</p>

<blockquote>
  <p>그렇다면 꼭 하나의 단어로 해야만 하는가? 문서 전체의 단어의 공기 정보를 추출 하는 것은 안되는가?</p>
</blockquote>

<p>이와 같은 생각이 GloVe 를 탄생시켰다.</p>

<h1 id="glove">GloVe</h1>

<p>Paper: <a href="https://www.aclweb.org/anthology/D14-1162">GloVe: Global Vectors for Word Representation</a></p>

<p>GloVe 의 학습방법은 아래와 같다.</p>

<script type="math/tex; mode=display">J(\theta) = \dfrac{1}{2} \sum_{i,j=1}^{W} f(P_{ij})(u_i^T v_j - \log P_{ij})^2</script>

<p>논문해설을 통해서 자세히 보자.</p>

<hr />
<h2 id="논문-해설">논문 해설</h2>

<p><strong>GloVe:</strong> Global Vectors라고 명칭을 지은 이유는 모델에서 직접적으로 문서 전체의 코퍼스 통계량을 포착할 수있기 때문이다. (the global corpus statistics are captured directly by the model)</p>

<p>그전에 notation 을 정의해보자.</p>

<p>Define notation:</p>
<ul>
  <li>$X$: 단어간의 공기 매트릭스 (matrix of word-word co-occurrence counts)</li>
  <li>$X_{ij}$: 단어 $j$ 와 문맥 단어 $i$ 가 같이 등장한 횟수 (the number of times that word $j$ occurs in the context word $i$)</li>
  <li>$X_i = \sum_k X_{ik}$: 어떤 단어든 문맥 단어 $i$ 와 등장한 횟수 (the number of times any word appears in the context of word $i$)</li>
  <li>$P_{ij} = P(j \vert i) = X_{ij} / X_i$: 단어 $j$ 와 문맥 단어 $i$ 동시 등장할 확률, 문맥 단어 $i$ 가 주어졌을 때 $j$ 가 등장할 확률 (probability that word $j$ appear in the context word $i$)</li>
</ul>

<p>아래의 예시를 보자.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Probability and Ratio</th>
      <th style="text-align: center">$k=solid$</th>
      <th style="text-align: center">$k=gas$</th>
      <th style="text-align: center">$k=water$</th>
      <th style="text-align: center">$k=fashion$</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">$P(k\vert ice)$</td>
      <td style="text-align: center">0.00019</td>
      <td style="text-align: center">0.000066</td>
      <td style="text-align: center">0.003</td>
      <td style="text-align: center">0.000017</td>
    </tr>
    <tr>
      <td style="text-align: left">$P(k\vert steam)$</td>
      <td style="text-align: center">0.000022</td>
      <td style="text-align: center">0.00078</td>
      <td style="text-align: center">0.0022</td>
      <td style="text-align: center">0.000018</td>
    </tr>
    <tr>
      <td style="text-align: left">$P(k\vert ice)/P(k\vert steam)$</td>
      <td style="text-align: center">8.9</td>
      <td style="text-align: center">0.085</td>
      <td style="text-align: center">1.36</td>
      <td style="text-align: center">0.96</td>
    </tr>
  </tbody>
</table>

<p>위의 표에 따르면 $i=ice, j=steam$ 일때 $solid$ 와 동시 등장 확률이 높은 단어는 $ice$ 다. 직관적으로 생각해도, 단단한 $ice$ 가 $solid$ 와 연관될 확률이 더 높다. 따러서, 우리는 $P(k\vert ice)/P(k\vert steam)$ 를 구해서, 연관이 있는 단어일 경우 이 비율이 크게 높으며, 아니면 그 반대다. <strong>(엄청 크거나 혹은 엄청 작거나)</strong></p>

<p>이처럼 직접적으로 단어간의 동시등장 확률을 비교하는 것보다. 확률간의 비율을 구하는 것이 <strong>연관성이 없는</strong> 단어(water &amp; fashion)들로 부터 관련된 단어(solid &amp; gas)를 구별하기 좋으며, <strong>관련성 있는</strong> 단어(solid &amp; gas)들을 차별화 하기에도 좋다.</p>

<p>따라서 <strong><span style="color: #e87d7d">동시 등장 확률의 비율(ratios of co-occurrence probabilities)</span></strong> 을 모델이 학습하게 하는 것이 바람직 해보인다.</p>

<p>중요한 것은 이 비율은 3개의 단어 $i, j, k$ 와 연관이 있다. 따라서 아래의 함수를 구성할 수가 있다.</p>

<script type="math/tex; mode=display">F(w_i, w_j, \tilde{w}_k) = \dfrac{P_{ik} }{P_{jk} } \cdots (1)</script>

<ul>
  <li>$w \in \Bbb{R}^d$: word vectors</li>
  <li>$\tilde{w} \in \Bbb{R}^d$: separate context word vectors</li>
</ul>

<p>$(1)$ 식과 같이, 단어 벡터 공간에서 $w_i, w_j, \tilde{w}_k$ 를 input으로 넣었을 때,</p>

<p>$\dfrac{ P_{ik} }{ P_{jk} }$ 비율을 나타내는 하는 선형구조인 함수를 구하는 것이 목적이다. 그리고 $F$ 를 아래와 같이 변형시켜 본다.</p>

<script type="math/tex; mode=display">F((w_i - w_j)^T \tilde{w}_k) = \dfrac{P_{ik} }{P_{jk} } \cdots (2)</script>

<p>이로써 선형적인 관계를 포착하고, 양변 모두 스칼라 값으로 정해진 함수가 만들어 졌다. 그러나 단어 $i, j$ 와 $k$ 동시 등장 비율의 <strong>임의적인 차별화</strong> 를 위해서 어떤 조건들을 만족해야한다. 그 조건들이란 단어 벡터 $w$ 와 문맥 단어 벡터 $\tilde{w}$ 간 서로 자유롭게 교환 될 수가 있어야 한다. 즉, 단어간 공기 매트릭스 $X$의 대칭(symmetric) 특성을 보존해야 한다.</p>

<p><strong>임의적인 차별화</strong> 가 무슨 말이냐면, 단어 $k$ 와 $i, j$ 단어 간의 비율을 확인 할때, $i$ 와 $k, j$ (혹은 $j$ 와 $i, k$) 의 관계도 확인 할 수 있어야 된다는 말이다.</p>

<p>대칭(symmetric) 을 만족하려면 2 단계로 진행 된다. 우선, 두 그룹 $(\Bbb{R}, +)$ 과 $(\Bbb{R}_{&gt;0}, \times)$ 에 대해서 함수 $F$ 가 <strong>homomorphism</strong> 이어야 한다. (homomorphism 해설: 밑에 <span style="color: #e87d7d">참고 1</span>를 보라), 예를 들어 아래와 같다.</p>

<script type="math/tex; mode=display">F(w_i, w_j, \tilde{w}_k) = \dfrac{F(w_i^T \tilde{w}_k) }{F(w_j^T \tilde{w}_k) } \cdots (3)</script>

<p>$(2)$ 식에 의해서, 아래와 같이 풀 수 있다.</p>

<script type="math/tex; mode=display">F(w_i^T \tilde{w}_k) = P_{ik} = \dfrac{X_{ik} }{X_i} \cdots (4)</script>

<p>$(3)$ 식에 만족하는 해답은 $F = \exp$ 임으로, 아래의 식을 도출 해낼 수 있다.</p>

<script type="math/tex; mode=display">w_i^T \tilde{w}_k = \log(P_{ik}) = \log(X_{ik}) - \log(X_i) \cdots (5)</script>

<p>다음으로, $(5)$ 식은 $\log(X_i)$ 만 아니였다면 대칭이었을 것이다. $\log(P_{ik})=\log(P_{ki})$ 를 만족하는지 한번 보자.</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{aligned}
\log(P_{ik}) &= \log(X_{ik}) - \log(X_i) \\
\log(P_{ki}) &= \log(X_{ki}) - \log(X_k)
\end{aligned} %]]></script>

<p>당연하게도, $\log(X_i) \neq \log(X_k)$ 이기 때문에 $\log(P_{ik}) \neq \log(P_{ki})$ 이다.</p>

<p>하지만 $\log(X_i)$ 부분은 $k$ 에 대해서 독립적(independent) 이기 때문에, $w_i$ 의 bias $b_i$ 항으로 들어갈 수 있다. 그리고 대칭성을 유지하기 위해서 $\tilde{w}_k$ 의 bias $\tilde{b}_k$ 항도 더해준다.</p>

<script type="math/tex; mode=display">w_i^T \tilde{w}_k + b_i + \tilde{b}_k = \log(X_{ik}) \cdots (6)</script>

<p>$(6)$ 식이 우리의 제일 간단한 선형관계인 solution 이라고 해도 되지만 이는 문제가 좀 있다. $X_{ik} = 0$ 에서 명확하게 정의 되지 않는다. 이를 해결하기 위해서 $X_{ik}+1$ 하는 방법도 있지만, sparsity issue 를 벗어나기 힘들다. 그리고 하나의 큰 약점이 있다면 거의 등장하지 않는 단어들에게 동시 등장 비율이 모두 같을 수 있다는 점이다. 이게 왜 문제가 되냐면, co-occurrence 가 적을 수록 많이 등장하는 단어들 보다 정보 함량이 적고 데이터도 noisy 하기 때문이다.</p>

<p>연구팀은 새로운 weighted least squares regression model 을 제시하여 문제를 풀고자 했다.</p>

<script type="math/tex; mode=display">J(\theta) = \dfrac{1}{2} \sum_{i,j=1}^{W} f(X_{ij})(w_i^T \tilde{w}_j + b_i + \tilde{b}_j - \log X_{ij})^2 \cdots (7)</script>

<p>가중치 함수 (Weighting function) $f(X_{ij})$ 는 아래의 특성을 따라야 한다.</p>

<ol>
  <li>$f(0) = 0$. 만약 $f$ 가 연속함수(continuous function) 라면, $x \rightarrow 0$ 으로 갈때 $\lim_{x\rightarrow 0} f(x) log^2x$ 도 빠르게 수렴한다. 단, 유한한 값이여야 한다.</li>
  <li>$f(x)$ 는 감소함수가 되면 안된다. (non-decreasing) 이유는 동시 등장이 희박한 단어들의 가중치가 많아져서는 안되기 때문이다.</li>
  <li>$f(x)$ 는 큰 $x$ 값에 대해서 상대적으로 작은 값이어야 한다. 그 이유는 공기 횟수가 큰 단어들의 가중치가 너무 높게 설정하지 않기 위해서다.</li>
</ol>

<p>연구팀은 이에 적합한 함수를 찾았다.</p>

<script type="math/tex; mode=display">% <![CDATA[
f(x) =
\begin{cases} (x/x_{max})^{\alpha} \quad if\ x < x_{max} \\
1 \quad otherwise
\end{cases} %]]></script>

<p><img src="/assets/ML/nlp/L3_weight_f.png" /></p>

<p>그림: $f(x)$ with $\alpha = 3/4$ 일때 좋은 성과를 얻었다. 재밌는 것은 Mikolov 논문에서 나온 unigram distribution 에 3/4 승을 해주는 것과 같다는 것을 발견했다.</p>

<p>조금더 general 한 weighting function 은 아래와 같다. (자세한건 논문 3.1 참고)</p>

<script type="math/tex; mode=display">\hat{J} = \sum_{i,j} f(X_{ij})(w_i^T \tilde{w}_j - \log X_{ij})^2</script>

<p>이는 연구팀이 도출한 $(7)$ 식과 같은 식이다.</p>

<hr />
<h2 id="참고-1-homomorphism">참고 1: Homomorphism</h2>

<p>혹시나 틀렸으면 댓글로 이야기 해주세요.</p>

<p>우선 Group <a href="https://en.wikipedia.org/wiki/Group_(mathematics)">(위키 링크)</a> 이란 것을 알아야한다. 내가 이해한 바로는 <strong>Group $(G, * )$</strong> 이란, 집합 $G$ 와 연산 $* $ 로 구성되어 있다. 이 연산을 “the Group Law of $G$” 라고 부른다. 집합 $G$ 에 속한 원소 $a, b$ 의 연산을 $a * b$ 라고 표현한다. 또한 아래의 조건들을 만족해야한다.</p>
<ol>
  <li>Closure: $* $ 연산은 $G$ 에 대해 닫혀 있어야한다. 즉, $a * b$ 연산도 집합 $G$ 에 속해야한다.</li>
  <li>Associativity: 교환 법칙이 성립해야한다. $(a * b) * c = a * (b * c)$</li>
  <li>Identity element: 항등원이 존재해야 한다. $a * e = a = e * a$</li>
  <li>Inverse element: 역원이 존재해야 한다. $a * x = e = x * a$</li>
</ol>

<p>Group 를 이해 했으면 이제 Homomorphism 을 이해해보자.</p>

<p><strong>정의:</strong></p>

<p>두 그룹 <span style="color: #15b23c">$(G, * )$</span> 과 <span style="color: #9013b2">$(H, @)$</span> 가 있으면, 모든 <span style="color: #15b23c">$x, y \in G$</span> 에 대해서 $f:$ <span style="color: #15b23c">$G$</span> $\rightarrow$ <span style="color: #9013b2">$H$</span>, <span style="color: #15b23c">$f(x * y)$</span> $=$ <span style="color: #9013b2">$f(x) @ f(y)$</span> 를 만족하는 map 을 말한다.</p>

<p><strong>예시)</strong>
두 그룹 <span style="color: #15b23c">$(\Bbb{R}, + )$</span> 와 <span style="color: #9013b2">$(\Bbb{R}_{&gt;0}, \times )$</span> 사이에 어떤 map $f:$ <span style="color: #15b23c">$\Bbb{R}$</span> $\rightarrow$ <span style="color: #9013b2">$\Bbb{R}_{&gt;0}$</span>, $f(x)=e^x$ 가 있다면, $f$ 가 Homomorphism 인지를 밝혀라.</p>

<blockquote>
  <p>for any <span style="color: #15b23c">$x, y \in \Bbb{R}$</span>,</p>

  <p><span style="color: #15b23c">$f(x + y)$</span> $=$ <span style="color: #9013b2">$e^{x+y}$</span> $=$ <span style="color: #9013b2">$e^x \times e^y$</span> $=$ <span style="color: #9013b2">$f(x) \times f(y)$</span> 임으로</p>

  <p>Homomorphism 을 만족한다.</p>
</blockquote>

<hr />
<p>word2vec 과 glove 관련 포스팅은 <strong>“All about word vectors”</strong> 시리즈로 마치겠다. 기회가 되면 gensim 의 사용법과, 데이터 차원 축소와 시각화 방법인 t-SNE 을 포스팅 하도록 하겠다.</p>

    </div>
  </div>
  <footer class="article-footer">

  <div class="pagination to-top-post"><a href="https://simonjisu.github.io/archive#nlp">
    <data data-icon="ei-arrow-up"></data> Go Back to Posts  </a>
</div>
  <section class="buymecoffee">
    <p>이 글이 도움이 되었다면?</p> 
<style>.bmc-button img{width: 27px !important;margin-bottom: 1px !important;box-shadow: none !important;border: none !important;vertical-align: middle !important;}.bmc-button{line-height: 36px !important;height:37px !important;text-decoration: none !important;display:inline-flex !important;color:#000000 !important;background-color:#FFDD00 !important;border-radius: 3px !important;border: 1px solid transparent !important;padding: 1px 9px !important;font-size: 22px !important;letter-spacing:0.6px !important;box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important;-webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;margin: 0 auto !important;font-family:'Cookie', cursive !important;-webkit-box-sizing: border-box !important;box-sizing: border-box !important;-o-transition: 0.3s all linear !important;-webkit-transition: 0.3s all linear !important;-moz-transition: 0.3s all linear !important;-ms-transition: 0.3s all linear !important;transition: 0.3s all linear !important;}.bmc-button:hover, .bmc-button:active, .bmc-button:focus {-webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;text-decoration: none !important;box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;opacity: 0.85 !important;color:#000000 !important;}</style >
<link href="https://fonts.googleapis.com/css?family=Cookie" rel="stylesheet">
<a class="bmc-button" 
target="_blank" 
href="https://www.buymeacoffee.com/ZWoFwrh">
    <img src="https://bmc-cdn.nyc3.digitaloceanspaces.com/BMC-button-images/BMC-btn-logo.svg" alt="Buy me a coffee">
    <span style="margin-left:5px">Buy me a coffee</span>
</a>
</section>
  <section class="author">
  <div class="authorimage box" style="background: url(/assets/img/author.jpg)"></div>
  <div class="authorinfo box">
    <p class="biotitle">Soopace</p>
    <p class="biosubdesc">Machine Learning Learner.</p>
    <a class="icon" href="https://github.com/simonjisu" target="_blank"><img src="/assets/img/github-circle-64px.png"></a>
    <a class="icon" href="https://facebook.com/simonjisu" target="_blank"><img src="/assets/img/facebook-circle-64px.png"></a>
    <a class="icon" href="mailto:simonjisu@gmail.com" target="_blank"><img src="/assets/img/email-circle-64px.png"></a>
  </div>
</section>
  
  </footer>
  
  
</article>

          </div>
        </div>
      </div>
      <footer class="site-footer">
  <div class="container">
    <div class="footer left column one-half">
      <section class="small-font">
        © Powered by <a href="https://github.com/jekyll/jekyll">jekyll</a>
      </section>
    </div>

    <div class="footer right column one-half">
      <section class="small-font">
        
        <a href="https://github.com/simonjisu"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span></a>

        
      </section>
    </div>
  </div>
</footer>

      
      
    </div>
  </body>
</html>
